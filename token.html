<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MCP è©³ç´°åˆ†æ</title>
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chartist/dist/chartist.min.css">
</head>
<body>
  <h1 class="section-title">ğŸ“Š å¹£ç¨®è©³æƒ…åˆ†æ</h1>
  <div id="token-detail"></div>

  <script src="https://cdn.jsdelivr.net/npm/chartist"></script>
  <script>
    const params = new URLSearchParams(location.search);
    const tokenId = params.get("id");
    let allTokens = [];

    async function init() {
      const res = await fetch("tokens.json");
      allTokens = await res.json();
      const token = allTokens.find(t => t.id === tokenId);
      if (!token) return showError("âŒ æ‰¾ä¸åˆ°ä»£å¹£è³‡æ–™");
      renderToken(token);
    }

    function renderToken(token) {
      const score = calcScore(token.total_volume, token.price_change_percentage_24h);
      const advice = getAdvice(score);
      document.getElementById("token-detail").innerHTML = `
        <h2>${token.name} (${token.symbol})</h2>
        <p>æˆäº¤é‡ï¼š$${token.total_volume.toLocaleString()}</p>
        <p>24h æ¼²è·Œï¼š<span class="${token.price_change_percentage_24h >= 0 ? 'text-green-400' : 'text-red-400'}">
          ${token.price_change_percentage_24h.toFixed(2)}%</span></p>
        <p class="ai-advice">ğŸ§  AI åˆ†æï¼š${advice}</p>
        <div class="ct-chart" id="price-chart"></div>
        <br>
        <button onclick="location.href='index.html'">â† è¿”å›æ§åˆ¶å°</button>
      `;
      renderChart(token);
    }

    function renderChart(token) {
      const base = token.price_change_percentage_24h ?? 0;
      const mock = [100, 100 + base, 100 - base / 2, 100 + base * 0.8, 100 + base];
      new Chartist.Line('#price-chart', {
        labels: ['é€±ä¸€','é€±äºŒ','é€±ä¸‰','é€±å››','é€±äº”'],
        series: [mock]
      }, {
        showArea: true,
        fullWidth: true,
        chartPadding: { right: 40 },
        lineSmooth: Chartist.Interpolation.cardinal({ tension: 0.4 })
      });
    }

    function calcScore(volume, change) {
      const v = Math.min(volume / 1e9, 2);
      const c = change / 5;
      return parseFloat(Math.max(5, Math.min(10, (v + c) * 1.5)).toFixed(1));
    }

    function getAdvice(score) {
      if (score >= 8.5) return "ğŸ“ˆ æŠ€è¡“å¼·å‹ã€äº¤æ˜“é‡æ´»èºï¼ŒçŸ­æœŸçœ‹å¤š";
      if (score <= 6) return "ğŸ§ åƒ¹æ ¼éœ‡ç›ªå¤§ã€é‡èƒ½ä¸è¶³ï¼Œå»ºè­°è§€å¯Ÿ";
      return "ğŸŒ¿ ç©©å®šä¸­ï¼Œä¸­é•·ç·šæŒæœ‰å»ºè­°";
    }

    function showError(msg) {
      document.getElementById("token-detail").innerHTML = `<p class="alert-banner">${msg}</p>`;
    }

    init();
  </script>
</body>
</html>
